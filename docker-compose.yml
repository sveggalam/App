version: '3.8'

services:

  # ==============================
  # STUDENT DATABASE
  # ==============================
  student-db:
    image: postgres:15
    container_name: student-db
    environment:
      POSTGRES_DB: studentdb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5433:5432"
    volumes:
      - student-db-data:/var/lib/postgresql/data
    networks:
      - micro-net

  # ==============================
  # STUDENT SERVICE
  # ==============================
  student:
    build: ./studentMicroservice
    container_name: student
    ports:
      - "8081:8081"
    environment:
      DB_URL: jdbc:postgresql://student-db:5432/studentdb
      DB_USER: postgres
      DB_PASS: password
    depends_on:
      - student-db
    networks:
      - micro-net

  # ==============================
  # LIBRARY DATABASE
  # ==============================
  library-db:
    image: postgres:15
    container_name: library-db
    environment:
      POSTGRES_DB: librarydb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5434:5432"
    volumes:
      - library-db-data:/var/lib/postgresql/data
    networks:
      - micro-net

  # ==============================
  # LIBRARY SERVICE
  # ==============================
  library:
    build: ./libraryMicroservice
    container_name: library
    ports:
      - "8082:8082"
    environment:
      DB_URL: jdbc:postgresql://library-db:5432/librarydb
      DB_USER: postgres
      DB_PASS: password
    depends_on:
      - library-db
    networks:
      - micro-net

  # ==============================
  # MESS DATABASE
  # ==============================
  mess-db:
    image: postgres:15
    container_name: mess-db
    environment:
      POSTGRES_DB: messdb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5435:5432"
    volumes:
      - mess-db-data:/var/lib/postgresql/data
    networks:
      - micro-net

  # ==============================
  # MESS SERVICE
  # ==============================
  mess:
    build: ./messMicroservice
    container_name: mess
    ports:
      - "8083:8083"
    environment:
      DB_URL: jdbc:postgresql://mess-db:5432/messdb
      DB_USER: postgres
      DB_PASS: password
    depends_on:
      - mess-db
    networks:
      - micro-net

  # ==============================
  # AUTH SERVICE
  # ==============================
  auth:
    build: ./auth-service
    container_name: auth
    ports:
      - "8079:8079"
    networks:
      - micro-net

  # ==============================
  # API GATEWAY
  # ==============================
  gateway:
    build: ./apiGateway
    container_name: gateway
    ports:
      - "8080:8080"
    depends_on:
      - student
      - library
      - mess
      - auth
    networks:
      - micro-net

# ==============================
# NETWORK
# ==============================
networks:
  micro-net:
    driver: bridge

# ==============================
# VOLUMES
# ==============================
volumes:
  student-db-data:
  library-db-data:
  mess-db-data:
